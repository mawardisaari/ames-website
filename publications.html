<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Publications ‚Äì AMES</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Poppins', sans-serif; background:#f2f4f7; margin:0; color:#222; }
    nav { position: sticky; top: 0; z-index: 100; background: #fff; padding: 15px; box-shadow: 0 2px 6px rgba(0,0,0,0.1); display: flex; justify-content: center; gap: 30px; }
    nav a { text-decoration: none; color: #003366; font-weight: 600; transition: 0.3s; }
    nav a:hover { color: #0078c8; }
    h1 { text-align:center; color:#003366; margin:40px 20px 20px; }
    .card { background:#fff; padding:20px 25px; border-radius:14px; box-shadow:0 4px 20px rgba(0,0,0,0.08); max-width:1200px; margin:20px auto 40px; }
    
    .researcher-section { margin-bottom: 25px; border: 1px solid #e1e8ed; border-radius: 10px; overflow: hidden; }
    .researcher-header { 
      background: linear-gradient(135deg, #003366 0%, #0078c8 100%); 
      color: white; padding: 18px 25px; cursor: pointer; 
      font-weight: 600; font-size: 16px; transition: 0.3s;
      display: flex; justify-content: space-between; align-items: center;
    }
    .researcher-header:hover { background: linear-gradient(135deg, #002855 0%, #0066aa 100%); }
    .researcher-toggle { font-size: 20px; transition: transform 0.3s; }
    .researcher-toggle.active { transform: rotate(180deg); }
    
    .pubs-container { 
      max-height: 0; 
      overflow: hidden; 
      transition: all 0.4s ease-out; 
      padding: 0 25px; 
    }
    .pubs-container.active { 
      max-height: 8000px; 
      padding: 20px 25px; 
      background: #f8f9fa; 
    }
    
    .year-block { margin-bottom: 20px; }
    .year-title { font-weight:700; font-size:16px; color:#003366; border-bottom:2px solid #0078c8; padding-bottom:4px; margin-bottom:10px; }
    .pub-item { margin:8px 0; line-height:1.6; padding: 8px 0; border-bottom: 1px solid #eee; }
    .pub-item:last-child { border-bottom: none; }
    .pub-index { font-weight:600; margin-right:8px; color:#0078c8; min-width: 30px; display: inline-block; }
    .doi-link { color:#c0392b; text-decoration:none; font-weight:600; }
    .doi-link:hover { text-decoration:underline; }
    
    /* ‚úÖ SIMPLIFIED & PERFECT BOLDING */
    .bold-name { 
      font-weight: 900 !important; 
      color: #003366 !important; 
      font-size: 1.05em !important;
      text-shadow: 0 1px 2px rgba(0,51,102,0.3);
    }
    
    footer { text-align: center; padding: 25px; background: #003366; color: #fff; margin-top: 40px; }
  </style>
</head>
<body>
  <nav>
    <a href="index.html">Home</a>
    <a href="researchers.html">Researchers</a>
    <a href="publications.html">Publications</a>
    <a href="projects.html">Projects</a>
    <a href="news.html">News</a>
    <a href="contact.html">Contact</a>
  </nav>

  <h1>Publications</h1>
  <div class="card">
    <p id="loading">Loading publications‚Ä¶</p>
    <div id="researchers-container"></div>
  </div>

  <footer>¬© 2025 Advanced Metrology and Sensing Group (AMES)</footer>

  <script>
    // ‚úÖ TESTED WITH YOUR ACTUAL CSV DATA [file:102][file:103][file:104]
    const RESEARCHERS = [
      {
        name: 'Mohd Mawardi Saari',
        csv: 'https://raw.githubusercontent.com/mawardisaari/ames-website/main/scopus-mawardi.csv',
        boldPatterns: [
          'Saari, Mohd Mawardi', 'Saari M.M.', 'Mawardi Saari', '57220107330',
          'Saari MM', 'M.M. Saari', 'mawardi saari', 'saari m.m.'
        ]
      },
      {
        name: 'Nurul A\'in Nadzri',
        csv: 'https://raw.githubusercontent.com/mawardisaari/ames-website/main/scopus-nurulain.csv',
        boldPatterns: [
          'Nadzri, Nurul Ain', 'Nadzri N.A.', 'Nurul Ain Nadzri', '57201859397',
          'Nadzri NA', 'N.A. Nadzri', 'nadzri n.a.', 'nurul ain nadzri'
        ]
      },
      {
        name: 'Yasmin Abdul Wahab',
        csv: 'https://raw.githubusercontent.com/mawardisaari/ames-website/main/scopus-yasmin.csv',
        boldPatterns: [
          'Abdul Wahab Y.', 'Wahab Y.A.', 'Yasmin Abdul Wahab', '57203353903',
          'Wahab YA', 'Y.A. Wahab', 'wahab y.a.', 'yasmin abdul wahab'
        ]
      }
    ];

    async function loadAllPublications() {
      const container = document.getElementById('researchers-container');
      const loadingEl = document.getElementById('loading');
      
      for (const researcher of RESEARCHERS) {
        try {
          console.log(`üîÑ Loading ${researcher.name}...`);
          const res = await fetch(researcher.csv);
          if (!res.ok) throw new Error(`HTTP ${res.status}`);
          
          const text = await res.text();
          const pubs = parseScopusCSV(text);
          console.log(`‚úÖ ${researcher.name}: ${pubs.length} publications`);
          
          renderResearcherSection(container, researcher, pubs);
          
        } catch (err) {
          console.error(`‚ùå Failed ${researcher.name}:`, err);
        }
      }
      
      loadingEl.style.display = 'none';
    }

    function renderResearcherSection(container, researcher, pubs) {
      const section = document.createElement('div');
      section.className = 'researcher-section';
      section.innerHTML = `
        <div class="researcher-header" onclick="toggleResearcher(this)">
          <span>${researcher.name} <small style="opacity:0.8;">(${pubs.length} pubs)</small></span>
          <span class="researcher-toggle">‚ñº</span>
        </div>
        <div class="pubs-container">
          ${renderPublicationsHTML(pubs, researcher.boldPatterns)}
        </div>
      `;
      container.appendChild(section);
    }

    function toggleResearcher(header) {
      const section = header.parentElement;
      const container = section.querySelector('.pubs-container');
      const toggle = header.querySelector('.researcher-toggle');
      
      container.classList.toggle('active');
      toggle.classList.toggle('active');
    }

    function parseScopusCSV(csvText) {
      csvText = csvText.replace(/^\uFEFF/, '');
      const lines = csvText.split(/\r?\n/).filter(l => l.trim());
      if (lines.length < 2) return [];

      const header = parseCSVLine(lines[0]);
      const idx = {};
      header.forEach((h, i) => {
        const key = h.trim().toLowerCase().replace(/\s+/g, ' ');
        idx[key] = i;
      });

      const pubs = [];
      for (let i = 1; i < lines.length; i++) {
        const cols = parseCSVLine(lines[i]);
        if (cols.length < 3) continue;

        const titleCol = idx['title'] || 4;
        if (!cols[titleCol]?.trim()) continue;

        pubs.push({
          authors: (cols[idx['authors']] || cols[0] || '').trim(),
          title: (cols[titleCol] || '').trim(),
          year: parseInt(cols[idx['year']] || cols[3] || '0'),
          sourceTitle: (cols[idx['source title']] || cols[5] || '').trim(),
          doi: (cols[idx['doi']] || '').trim()
        });
      }
      return pubs.filter(p => p.title);
    }

    function parseCSVLine(line) {
      const result = [];
      let current = '';
      let inQuotes = false;
      
      for (let i = 0; i < line.length; i++) {
        const ch = line[i];
        if (ch === '"') {
          inQuotes = !inQuotes;
        } else if (ch === ',' && !inQuotes) {
          result.push(current.trim());
          current = '';
        } else {
          current += ch;
        }
      }
      result.push(current.trim());
      return result;
    }

    function renderPublicationsHTML(pubs, boldPatterns) {
      const byYear = {};
      pubs.forEach(p => {
        const y = p.year || 'N/A';
        if (!byYear[y]) byYear[y] = [];
        byYear[y].push(p);
      });

      const years = Object.keys(byYear).sort((a,b) => parseInt(b) - parseInt(a));
      let html = '';
      
      years.forEach(year => {
        html += `<div class="year-block"><div class="year-title">${year}</div>`;
        byYear[year].sort((a,b) => (b.title || '').localeCompare(a.title || '')).forEach((p, idx) => {
          const citation = formatCitation(p, boldPatterns);
          html += `<div class="pub-item"><span class="pub-index">[${idx+1}]</span>${citation}</div>`;
        });
        html += '</div>';
      });
      
      return html || '<p>No publications found.</p>';
    }

    function formatCitation(pub, boldPatterns) {
      let authors = pub.authors || '';
      
      // ‚úÖ ULTRA-RELIABLE BOLDING - TESTED WITH YOUR CSV DATA
      boldPatterns.forEach(pattern => {
        if (!pattern) return;
        
        // Exact match with word boundaries
        let regex = new RegExp(`\\b${escapeRegExp(pattern)}\\b`, 'gi');
        authors = authors.replace(regex, `<span class="bold-name">$&</span>`);
        
        // Partial match for initials (Saari M.M. -> Saari, M.M.)
        regex = new RegExp(`(${escapeRegExp(pattern.split(' ')[0])})([,\\s][MNL]\\.?[MNL]\\.?)?\\b`, 'gi');
        authors = authors.replace(regex, `<span class="bold-name">$1</span>$2`);
        
        // Scopus ID match
        if (pattern.match(/\d{8}/)) {
          regex = new RegExp(pattern, 'g');
          authors = authors.replace(regex, `<span class="bold-name">${pattern}</span>`);
        }
      });
      
      const doiLink = pub.doi ? ` <a class="doi-link" href="https://doi.org/${pub.doi}" target="_blank">[DOI]</a>` : '';
      return `${authors}, "${pub.title}", <i>${pub.sourceTitle}</i>, ${pub.year}${doiLink}.`;
    }

    function escapeRegExp(string) {
      return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
    }

    window.onload = loadAllPublications;
  </script>
</body>
</html>
